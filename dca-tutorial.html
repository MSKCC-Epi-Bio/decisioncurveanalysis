<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Decision Curve Analysis Tutorial</title>

<script src="site_libs/header-attrs-2.19/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="highlight/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="highlight/styles/agate.min.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Decision Curve Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="literature.html">Peer-Reviewed Literature</a>
</li>
<li>
  <a href="dca-tutorial.html">Software Tutorial</a>
</li>
<li>
  <a href="resources.html">Other Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mskcc-epi-bio/decisioncurveanalysis/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Decision Curve Analysis Tutorial</h1>

</div>


<p>Below we will walk through how to perform decision curve analysis for
binary and time-to-event outcomes using <strong>R</strong>,
<strong>Stata</strong>, <strong>SAS</strong>, and
<strong>Python</strong>. Code is provided for all languages and can be
downloaded or simply copy and pasted into your application to see how it
runs. For simplicity’s sake, however, we only show output from the R
functions; although, naturally, output is very similar irrespective of
programming language. .</p>
<div id="select-a-language" class="section level2">
<h2>Select a language</h2>
<div id="jrztljqulc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jrztljqulc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: none;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jrztljqulc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jrztljqulc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jrztljqulc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jrztljqulc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jrztljqulc .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jrztljqulc .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jrztljqulc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jrztljqulc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jrztljqulc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jrztljqulc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jrztljqulc .gt_column_spanner {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jrztljqulc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jrztljqulc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jrztljqulc .gt_from_md > :first-child {
  margin-top: 0;
}

#jrztljqulc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jrztljqulc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: none;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jrztljqulc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jrztljqulc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jrztljqulc .gt_row_group_first td {
  border-top-width: 2px;
}

#jrztljqulc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jrztljqulc .gt_first_summary_row {
  border-top-style: none;
  border-top-color: #D3D3D3;
}

#jrztljqulc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jrztljqulc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jrztljqulc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jrztljqulc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: none;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jrztljqulc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jrztljqulc .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jrztljqulc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jrztljqulc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jrztljqulc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jrztljqulc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jrztljqulc .gt_left {
  text-align: left;
}

#jrztljqulc .gt_center {
  text-align: center;
}

#jrztljqulc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jrztljqulc .gt_font_normal {
  font-weight: normal;
}

#jrztljqulc .gt_font_bold {
  font-weight: bold;
}

#jrztljqulc .gt_font_italic {
  font-style: italic;
}

#jrztljqulc .gt_super {
  font-size: 65%;
}

#jrztljqulc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#jrztljqulc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jrztljqulc .gt_indent_1 {
  text-indent: 5px;
}

#jrztljqulc .gt_indent_2 {
  text-indent: 10px;
}

#jrztljqulc .gt_indent_3 {
  text-indent: 15px;
}

#jrztljqulc .gt_indent_4 {
  text-indent: 20px;
}

#jrztljqulc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:150px;"/>
    <col style="width:150px;"/>
    <col style="width:150px;"/>
    <col style="width:150px;"/>
  </colgroup>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="border-top-width: 4px; border-top-style: solid; border-top-color: #000000;" scope="col" id="&lt;b&gt;&lt;a href=&quot;dca-tutorial-r.html&quot;&gt;&lt;font color=&quot;black&quot;&gt;R&lt;/a&gt;&lt;/b&gt;"><b><a href="dca-tutorial-r.html"><font color="black">R</a></b></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;b&gt;&lt;a href=&quot;dca-tutorial-r.html&quot;&gt;&lt;font color=&quot;black&quot;&gt;Stata&lt;/a&gt;&lt;/b&gt;"><b><a href="dca-tutorial-r.html"><font color="black">Stata</a></b></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;b&gt;&lt;a href=&quot;dca-tutorial-r.html&quot;&gt;&lt;font color=&quot;black&quot;&gt;SAS&lt;/a&gt;&lt;/b&gt;"><b><a href="dca-tutorial-r.html"><font color="black">SAS</a></b></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;b&gt;&lt;a href=&quot;dca-tutorial-r.html&quot;&gt;&lt;font color=&quot;black&quot;&gt;Python&lt;/a&gt;&lt;/b&gt;"><b><a href="dca-tutorial-r.html"><font color="black">Python</a></b></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="r" class="gt_row gt_center"><a href="dca-tutorial-r.html"><img src="images/r-icon.png" height="100" /></a></td>
<td headers="stata" class="gt_row gt_center"><a href="dca-tutorial-stata.html"><img src="images/stata-icon.png" height="55" /></a></td>
<td headers="sas" class="gt_row gt_center"><a href="dca-tutorial-sas.html"><img src="images/sas-icon.png" height="55" /></a></td>
<td headers="python" class="gt_row gt_center"><a href="dca-tutorial-python.html"><img src="images/python-icon.png" height="55" /></a></td></tr>
  </tbody>
  
  
</table>
</div>
<p><a href="https://github.com/MSKCC-Epi-Bio/decisioncurveanalysis/raw/main/rmd_chunks/chunks_as_scripts/dca-script.R" download target="_blank"><b>Download
DCA Code</b></a></p>
</div>
<div id="install-load" class="section level2">
<h2>Install &amp; Load</h2>
<p>Use the scripts below to install the decision curve analysis
functions and/or load them for use.</p>
<div id="section" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># install dcurves to perform DCA from CRAN
install.packages(&quot;dcurves&quot;)

# install other packages used in this tutorial
install.packages(
  c(&quot;tidyverse&quot;, &quot;survival&quot;, &quot;gt&quot;, &quot;broom&quot;,
    &quot;gtsummary&quot;, &quot;rsample&quot;, &quot;labelled&quot;)
)

# load packages
library(dcurves)
library(tidyverse)
library(gtsummary)</code></pre>
</div>
<div id="stata" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* install dca functions from GitHub.com
net install dca, from(&quot;https://raw.github.com/ddsjoberg/dca.stata/master/&quot;) replace</code></pre>
</div>
<div id="sas" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>/* source the dca macros from GitHub.com */
/* you can also navigate to GitHub.com and save the macros locally */
FILENAME dca URL &quot;https://raw.githubusercontent.com/ddsjoberg/dca.sas/main/dca.sas&quot;;
FILENAME stdca URL &quot;https://raw.githubusercontent.com/ddsjoberg/dca.sas/main/stdca.sas&quot;;
%INCLUDE dca;
%INCLUDE stdca;</code></pre>
</div>
<div id="python" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  # install dcurves to perform DCA (first install package via pip)
  # pip install dcurves
  from dcurves import dca, plot_graphs
  
  # install other packages used in this tutorial
  # pip install pandas numpy statsmodels lifelines
  import pandas as pd
  import numpy as np
  import statsmodels.api as sm
  import lifelines</code></pre>
</div>
</div>
<div id="section-1" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
</div>
</div>
<div id="binary-outcomes" class="section level2">
<h2>Binary Outcomes</h2>
<div id="motivating-example" class="section level3">
<h3>Motivating Example</h3>
<p>We will be working with an example data set containing information
about cancer diagnosis. The data set includes information on 750
patients who have recently discovered they have a gene mutation that
puts them at a higher risk for harboring cancer. Each patient has been
biopsied and we know their cancer status. It is known that older
patients with a family history of cancer have a higher probability of
harboring cancer. A clinical chemist has recently discovered a marker
that she believes can distinguish between patients with and without
cancer. We wish to assess whether or not the new marker does indeed
distinguish between patients with and without cancer. If the marker does
indeed predict well, many patients will not need to undergo a painful
biopsy.</p>
</div>
<div id="data-set-up" class="section level3">
<h3>Data Set-up</h3>
<p>We will go through step by step how to import your data, build models
based on multiple variables, and use those models to obtain predicted
probabilities. The first step is to import your data, label the
variables and produce a table of summary statistics. The second step is
you’ll want to begin building your model. As we have a binary outcome
(i.e. the outcome of our model has two levels: cancer or no cancer), we
will be using a logistic regression model.</p>
<div id="section-2" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-1" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># import data
df_cancer_dx &lt;-
  readr::read_csv(
    file = &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&quot;
  ) %&gt;%
  # assign variable labels. these labels will be carried through in the `dca()` output
  labelled::set_variable_labels(
    patientid = &quot;Patient ID&quot;,
    cancer = &quot;Cancer Diagnosis&quot;,
    risk_group = &quot;Risk Group&quot;,
    age = &quot;Patient Age&quot;,
    famhistory = &quot;Family History&quot;,
    marker = &quot;Marker&quot;,
    cancerpredmarker = &quot;Prediction Model&quot;
  )

# summarize data
df_cancer_dx %&gt;%
  select(-patientid) %&gt;%
  tbl_summary(type = all_dichotomous() ~ &quot;categorical&quot;)</code></pre>
</div>
<div id="stata-1" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* import data
import delimited &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&quot;, clear

* assign variable labels. these labels will be carried through in the DCA output
label variable patientid &quot;Patient ID&quot;
label variable cancer &quot;Cancer Diagnosis&quot;
label variable risk_group &quot;Risk Group&quot;
label variable age &quot;Patient Age&quot;
label variable famhistory &quot;Family History&quot;
label variable marker &quot;Marker&quot;
label variable cancerpredmarker &quot;Prediction Model&quot;</code></pre>
</div>
<div id="sas-1" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>FILENAME cancer URL &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&quot;;

PROC IMPORT FILE = cancer OUT = work.data_cancer DBMS = CSV;
RUN;

* assign variable labels. these labels will be carried through in the DCA output;
DATA data_cancer;
  SET data_cancer;

  LABEL patientid = &quot;Patient ID&quot;
        cancer = &quot;Cancer Diagnosis&quot;
        risk_group = &quot;Risk Group&quot;
        age = &quot;Patient Age&quot;
        famhistory = &quot;Family History&quot;
        marker = &quot;Marker&quot;
        cancerpredmarker = &quot;Prediction Model&quot;;
RUN;</code></pre>
</div>
<div id="python-1" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  df_cancer_dx = pd.read_csv(&#39;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&#39;)</code></pre>
</div>
</div>
<div id="section-3" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<div id="ghvvflkhcc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ghvvflkhcc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ghvvflkhcc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ghvvflkhcc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ghvvflkhcc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ghvvflkhcc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ghvvflkhcc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghvvflkhcc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ghvvflkhcc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ghvvflkhcc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ghvvflkhcc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ghvvflkhcc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ghvvflkhcc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ghvvflkhcc .gt_group_heading {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ghvvflkhcc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ghvvflkhcc .gt_from_md > :first-child {
  margin-top: 0;
}

#ghvvflkhcc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ghvvflkhcc .gt_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ghvvflkhcc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ghvvflkhcc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ghvvflkhcc .gt_row_group_first td {
  border-top-width: 2px;
}

#ghvvflkhcc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghvvflkhcc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ghvvflkhcc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ghvvflkhcc .gt_last_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghvvflkhcc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghvvflkhcc .gt_first_grand_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ghvvflkhcc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ghvvflkhcc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ghvvflkhcc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ghvvflkhcc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 1px;
  padding-right: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghvvflkhcc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ghvvflkhcc .gt_sourcenote {
  font-size: 90%;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ghvvflkhcc .gt_left {
  text-align: left;
}

#ghvvflkhcc .gt_center {
  text-align: center;
}

#ghvvflkhcc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ghvvflkhcc .gt_font_normal {
  font-weight: normal;
}

#ghvvflkhcc .gt_font_bold {
  font-weight: bold;
}

#ghvvflkhcc .gt_font_italic {
  font-style: italic;
}

#ghvvflkhcc .gt_super {
  font-size: 65%;
}

#ghvvflkhcc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ghvvflkhcc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ghvvflkhcc .gt_indent_1 {
  text-indent: 5px;
}

#ghvvflkhcc .gt_indent_2 {
  text-indent: 10px;
}

#ghvvflkhcc .gt_indent_3 {
  text-indent: 15px;
}

#ghvvflkhcc .gt_indent_4 {
  text-indent: 20px;
}

#ghvvflkhcc .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;N = 750&lt;/strong&gt;&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>N = 750</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Cancer Diagnosis</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_0" class="gt_row gt_center">645 (86%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_0" class="gt_row gt_center">105 (14%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Risk Group</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    high</td>
<td headers="stat_0" class="gt_row gt_center">21 (2.8%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    intermediate</td>
<td headers="stat_0" class="gt_row gt_center">335 (45%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    low</td>
<td headers="stat_0" class="gt_row gt_center">394 (53%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Patient Age</td>
<td headers="stat_0" class="gt_row gt_center">65.1 (61.7, 68.3)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Family History</td>
<td headers="stat_0" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_0" class="gt_row gt_center">635 (85%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_0" class="gt_row gt_center">115 (15%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Marker</td>
<td headers="stat_0" class="gt_row gt_center">0.64 (0.29, 1.38)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Prediction Model</td>
<td headers="stat_0" class="gt_row gt_center">0.06 (0.02, 0.18)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="2"><sup class="gt_footnote_marks">1</sup> n (%); Median (IQR)</td>
    </tr>
  </tfoot>
</table>
</div>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
</div>
</div>
<div id="univariate-decision-curve-analysis" class="section level3">
<h3>Univariate Decision Curve Analysis</h3>
<p>First, we want to confirm family history of cancer is indeed
associated with the biopsy result.</p>
<div id="section-4" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-2" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># build logistic regression model
mod1 &lt;- glm(cancer ~ famhistory, data = df_cancer_dx, family = binomial)

# model summary
mod1_summary &lt;- tbl_regression(mod1, exponentiate = TRUE)
mod1_summary</code></pre>
</div>
<div id="stata-2" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Test whether family history is associated with cancer
logit cancer famhistory</code></pre>
</div>
<div id="sas-2" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* Test whether family history is associated with cancer;
PROC LOGISTIC DATA = data_cancer DESCENDING;
  MODEL cancer = famhistory;
RUN;</code></pre>
</div>
<div id="python-2" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  mod1 = sm.GLM.from_formula(&#39;cancer ~ famhistory&#39;, data=df_cancer_dx, family=sm.families.Binomial())
  mod1_results = mod1.fit()
  
  print(mod1_results.summary())</code></pre>
</div>
</div>
<div id="section-5" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<div id="grflfppkdt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#grflfppkdt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#grflfppkdt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#grflfppkdt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#grflfppkdt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#grflfppkdt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#grflfppkdt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#grflfppkdt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#grflfppkdt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#grflfppkdt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#grflfppkdt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#grflfppkdt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#grflfppkdt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#grflfppkdt .gt_group_heading {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#grflfppkdt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#grflfppkdt .gt_from_md > :first-child {
  margin-top: 0;
}

#grflfppkdt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#grflfppkdt .gt_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#grflfppkdt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#grflfppkdt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#grflfppkdt .gt_row_group_first td {
  border-top-width: 2px;
}

#grflfppkdt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#grflfppkdt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#grflfppkdt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#grflfppkdt .gt_last_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#grflfppkdt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#grflfppkdt .gt_first_grand_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#grflfppkdt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#grflfppkdt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#grflfppkdt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#grflfppkdt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 1px;
  padding-right: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#grflfppkdt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#grflfppkdt .gt_sourcenote {
  font-size: 90%;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#grflfppkdt .gt_left {
  text-align: left;
}

#grflfppkdt .gt_center {
  text-align: center;
}

#grflfppkdt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#grflfppkdt .gt_font_normal {
  font-weight: normal;
}

#grflfppkdt .gt_font_bold {
  font-weight: bold;
}

#grflfppkdt .gt_font_italic {
  font-style: italic;
}

#grflfppkdt .gt_super {
  font-size: 65%;
}

#grflfppkdt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#grflfppkdt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#grflfppkdt .gt_indent_1 {
  text-indent: 5px;
}

#grflfppkdt .gt_indent_2 {
  text-indent: 10px;
}

#grflfppkdt .gt_indent_3 {
  text-indent: 15px;
}

#grflfppkdt .gt_indent_4 {
  text-indent: 20px;
}

#grflfppkdt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;OR&lt;/strong&gt;&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>OR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Family History</td>
<td headers="estimate" class="gt_row gt_center">1.80</td>
<td headers="ci" class="gt_row gt_center">1.07, 2.96</td>
<td headers="p.value" class="gt_row gt_center">0.022</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>Via logistic regression with cancer as the outcome, we can see that
family history is related to biopsy outcome with odds ratio 1.80 (95% CI
1.07, 2.96; p=0.022). The decision curve analysis can help us address
the clinical utility of using family history to predict biopsy
outcome.</p>
</div>
<div id="section-6" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-3" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ famhistory, data = df_cancer_dx) %&gt;%
  plot()</code></pre>
</div>
<div id="stata-3" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Run the decision curve: family history is coded as 0 or 1, i.e. a probability
* so no need to specify the “probability” option
dca cancer famhistory</code></pre>
</div>
<div id="sas-3" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* Run the decision curve: family history is coded as 0 or 1, i.e. a probability, so no need to specify the “probability” option;
%DCA(data = data_cancer, outcome = cancer, predictors = famhistory, graph = yes);</code></pre>
</div>
<div id="python-3" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  dca_famhistory_df = \
        dca(
            data=df_cancer_dx,
            outcome=&#39;cancer&#39;,
            modelnames=[&#39;famhistory&#39;]
        )

    plot_graphs(
        plot_df=dca_famhistory_df,
        graph_type=&#39;net_benefit&#39;,
        y_limits=[-0.05, 0.2]
    )</code></pre>
</div>
</div>
<div id="section-7" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_famhistory-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>First, note that there are many threshold probabilities shown here
that are not of interest. For example, it is unlikely that a patient
would demand that they had at least a 50% risk of cancer before they
would accept a biopsy. Let’s do the decision curve analysis again, this
time restricting the output to threshold probabilities a more clinically
reasonable range. We think it would be not make sense if a patient opted
for biopsy if their risk of cancer was less than 5%; similarly, it would
be irrational not to get a biopsy if risk was above 35%. So we want to
look at the range between 5% and 35%. Because 5% is pretty close to 0%,
we will show the range between 0% and 35%.</p>
</div>
<div id="section-8" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-4" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ famhistory,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01)
) %&gt;%
  plot()</code></pre>
</div>
<div id="stata-4" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca cancer famhistory, xstop(0.35) xlabel(0(0.05)0.35)</code></pre>
</div>
<div id="sas-4" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer, predictors = famhistory, graph = yes, xstop = 0.35);</code></pre>
</div>
<div id="python-4" class="section level5">
<h5>Python</h5>
<pre class="python"><code>dca_famhistory2_df = \
        dca(
            data=df_cancer_dx,
            outcome=&#39;cancer&#39;,
            modelnames=[&#39;famhistory&#39;],
            thresholds=np.arange(0, 0.36, 0.01),
        )

plot_graphs(
    plot_df=dca_famhistory2_df
)</code></pre>
</div>
</div>
<div id="section-9" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_famhistory2-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>Now that the graph is showing a more reasonable range of threshold
probabilities, let’s assess the clinical utility of family history
alone. We can see here that although family history is significantly
associated with biopsy outcome, it only adds value to a small range of
threshold probabilities near 13% - 20%. If your personal threshold
probability is 15% (i.e. you would only undergo a biopsy if your
probability of cancer was 15% or more), then family history alone can be
beneficial in making the decision to undergo biopsy. However, if your
threshold probability is less than 13% or higher than 20%, then using
family history to decide on biopsy has less benefit than choosing to
biopsy or not biopsy respectively. Hence, we would conclude that using
family history to determine who to biopsy would help some patients but
harm some others, and so should not be used in the clinic.</p>
</div>
</div>
<div id="multivariable-decision-curve-analysis" class="section level3">
<h3>Multivariable Decision Curve Analysis</h3>
<div id="evaluation-of-new-models" class="section level4">
<h4>Evaluation of New Models</h4>
<p>We want to examine the value of a statistical model that incorporates
family history, age, and the marker. First, we will build the logistic
regression model with all three variables, and then save the predicted
probability of having cancer based on the model. Note that in our
example data set, this variable actually already exists so it wouldn’t
be necessary to create the predicted probabilities once again.</p>
</div>
<div id="section-10" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-5" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># build multivariable logistic regression model
mod2 &lt;- glm(cancer ~ marker + age + famhistory, data = df_cancer_dx, family = binomial)

# summarize model
tbl_regression(mod2, exponentiate = TRUE)

# add predicted values from model to data set
df_cancer_dx &lt;-
  df_cancer_dx %&gt;%
  mutate(
    cancerpredmarker =
      broom::augment(mod2, type.predict = &quot;response&quot;) %&gt;%
      pull(&quot;.fitted&quot;)
  )</code></pre>
</div>
<div id="stata-5" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* run the multivariable model
logit cancer marker age famhistory

* save out predictions in the form of probabilities
capture drop cancerpredmarker
predict cancerpredmarker</code></pre>
</div>
<div id="sas-5" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* run the multivariable model;
PROC LOGISTIC DATA = data_cancer DESCENDING;
  MODEL cancer = marker age famhistory;
  * save out predictions in the form of probabilities;
  SCORE CLM OUT=dca (RENAME=(P_1 = cancerpredmarker));
RUN;</code></pre>
</div>
<div id="python-5" class="section level5">
<h5>Python</h5>
<pre class="python"><code>mod2 = sm.GLM.from_formula(&#39;cancer ~ marker + age + famhistory&#39;, data=df_cancer_dx, family=sm.families.Binomial())
mod2_results = mod2.fit()

print(mod2_results.summary())</code></pre>
</div>
</div>
<div id="section-11" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<div id="cxkxxgxajt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cxkxxgxajt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cxkxxgxajt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cxkxxgxajt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cxkxxgxajt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cxkxxgxajt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cxkxxgxajt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cxkxxgxajt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cxkxxgxajt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cxkxxgxajt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cxkxxgxajt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cxkxxgxajt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cxkxxgxajt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cxkxxgxajt .gt_group_heading {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cxkxxgxajt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cxkxxgxajt .gt_from_md > :first-child {
  margin-top: 0;
}

#cxkxxgxajt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cxkxxgxajt .gt_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cxkxxgxajt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cxkxxgxajt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cxkxxgxajt .gt_row_group_first td {
  border-top-width: 2px;
}

#cxkxxgxajt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#cxkxxgxajt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cxkxxgxajt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cxkxxgxajt .gt_last_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cxkxxgxajt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#cxkxxgxajt .gt_first_grand_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cxkxxgxajt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cxkxxgxajt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cxkxxgxajt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cxkxxgxajt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 1px;
  padding-right: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#cxkxxgxajt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cxkxxgxajt .gt_sourcenote {
  font-size: 90%;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#cxkxxgxajt .gt_left {
  text-align: left;
}

#cxkxxgxajt .gt_center {
  text-align: center;
}

#cxkxxgxajt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cxkxxgxajt .gt_font_normal {
  font-weight: normal;
}

#cxkxxgxajt .gt_font_bold {
  font-weight: bold;
}

#cxkxxgxajt .gt_font_italic {
  font-style: italic;
}

#cxkxxgxajt .gt_super {
  font-size: 65%;
}

#cxkxxgxajt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cxkxxgxajt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cxkxxgxajt .gt_indent_1 {
  text-indent: 5px;
}

#cxkxxgxajt .gt_indent_2 {
  text-indent: 10px;
}

#cxkxxgxajt .gt_indent_3 {
  text-indent: 15px;
}

#cxkxxgxajt .gt_indent_4 {
  text-indent: 20px;
}

#cxkxxgxajt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;OR&lt;/strong&gt;&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>OR</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95% CI&lt;/strong&gt;&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;p-value&lt;/strong&gt;"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Marker</td>
<td headers="estimate" class="gt_row gt_center">2.66</td>
<td headers="ci" class="gt_row gt_center">2.12, 3.38</td>
<td headers="p.value" class="gt_row gt_center"><0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Patient Age</td>
<td headers="estimate" class="gt_row gt_center">1.33</td>
<td headers="ci" class="gt_row gt_center">1.25, 1.41</td>
<td headers="p.value" class="gt_row gt_center"><0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Family History</td>
<td headers="estimate" class="gt_row gt_center">2.38</td>
<td headers="ci" class="gt_row gt_center">1.29, 4.32</td>
<td headers="p.value" class="gt_row gt_center">0.005</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>We now want to compare our different approaches to cancer detection:
biopsying everyone, biopsying no-one, biopsying on the basis of family
history, or biopsying on the basis of a multivariable statistical model
including the marker, age and family history of cancer.</p>
</div>
<div id="section-12" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-6" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ famhistory + cancerpredmarker,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01),
    label = list(cancerpredmarker = &quot;Prediction Model&quot;)
) %&gt;%
  plot(smooth = FALSE)</code></pre>
</div>
<div id="stata-6" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca cancer cancerpredmarker famhistory, xstop(0.35) xlabel(0(0.01)0.35)</code></pre>
</div>
<div id="sas-6" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer, predictors = cancerpredmarker famhistory, graph = yes, xstop = 0.35);</code></pre>
</div>
<div id="python-6" class="section level5">
<h5>Python</h5>
<pre class="python"><code># Following 3 Steps Coming Soon! 
# build multivariable logistic regression model
# summarize model
# add predicted values from model to data set

# Run dca on multivariable model
dca_multi_df = \
    dca(
        data=df_cancer_dx,
        outcome=&#39;cancer&#39;,
        modelnames=[&#39;famhistory&#39;, &#39;cancerpredmarker&#39;],
        thresholds=np.arange(0,0.36,0.01)
    )

plot_graphs(
    plot_df=dca_multi_df,
    y_limits=[-0.05, 0.2],
    graph_type=&#39;net_benefit&#39;
    )</code></pre>
</div>
</div>
<div id="section-13" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_multi-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>The key aspect of decision curve analysis is to look at which
strategy leads to the largest net benefit (i.e. the “highest” line),
which in this example would correspond to the model that includes age,
family history of cancer, and the marker. It is clear that the
statistical model has the highest net benefit across the entire range of
threshold probabilities. Accordingly, we would conclude that using the
model to decide whether to biopsy a patient would lead to better
clinical outcomes.</p>
<p>The decision curve for the model should in theory be a smooth curve
with net benefit always going down (or staying the same) as you move
from left to right. But the curve is a bit bumpy and sometimes even
increases a bit, a result of statistical noise. Some researchers prefer
to show a smoothed curve and there are two options for doing so. First,
you can add a smoother. Note that different programs use different
smoothers as there is no one smoother that is best in every situation.
As such, results of a smoothed curve should always be compared with the
unsmoothed curve to ensure that it gives a fair representation of the
data.</p>
</div>
<div id="section-14" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-7" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ famhistory + cancerpredmarker,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01),
    label = list(cancerpredmarker = &quot;Prediction Model&quot;)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-7" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca cancer cancerpredmarker famhistory, xstop(0.35) xlabel(0(0.01)0.35) smooth</code></pre>
</div>
<div id="sas-7" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer, predictors = cancerpredmarker famhistory, graph = yes, xstop = 0.35, smooth=yes);</code></pre>
</div>
<div id="python-7" class="section level5">
<h5>Python</h5>
<pre class="python"><code># Coming Soon!</code></pre>
</div>
</div>
<div id="section-15" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_smooth-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>An alternative is to calculate net benefit at wider intervals. By
default, the software calculates net benefit at every 1% of threshold
probability, but we this can cause artifacts unless the data set is very
large. You can specify instead to calculate net benefit every 5%.</p>
</div>
<div id="section-16" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-8" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ famhistory + cancerpredmarker,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.05),
    label = list(cancerpredmarker = &quot;Prediction Model&quot;)
) %&gt;%
  plot(smooth = FALSE)</code></pre>
</div>
<div id="stata-8" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca cancer cancerpredmarker famhistory, xstop(0.35) xlabel(0(0.05)0.35)</code></pre>
</div>
<div id="sas-8" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer, predictors = cancerpredmarker famhistory, graph = yes, xstop = 0.35, xby=0.05, smooth=no);</code></pre>
</div>
<div id="python-8" class="section level5">
<h5>Python</h5>
<pre class="python"><code># Coming Soon!</code></pre>
</div>
</div>
<div id="section-17" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_smooth2-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>You can also combine the two methods of smoothing together.</p>
<p>A few additional points are worth noting. First, look at the green
line, the net benefit for “treat all”, that is, biopsy everyone. This
crosses the y axis at the prevalence. Imagine that a man had a risk
threshold of 14%, and asked his risk under the “biopsy all” strategy. He
would be told that his risk was the prevalence (14%) and so would be
undecided about whether to biopsy or not. When a patient’s risk
threshold is the same as his predicted risk, the net benefit of
biopsying and not biopsying are the same.</p>
<p>Second, the decision curve for the binary variable (family history of
cancer, the brown line) crosses the “biopsy all men” line at 1 –
negative predictive value. Again, this is easily explained: the negative
predictive value is 87%, so a patient with no family history of cancer
has a probability of disease of 13%; a patient with a threshold
probability less than this – for example, a patient who would opt for
biopsy even if risk was 10% - should therefore be biopsied even if they
had no family history of cancer. The net benefit for a binary variable
is equivalent to biopsy no-one at the positive predictive value. This is
because for a binary variable, a patient with the characteristic is
given a risk at the positive predictive value.</p>
</div>
<div id="evaluation-of-published-models" class="section level4">
<h4>Evaluation of Published Models</h4>
<p>Imagine that a model was published by Brown et al. with respect to
our cancer biopsy data set. The authors reported a statistical model
with coefficients of 0.75 for a positive family history of cancer; 0.26
for each increased year of age, and an intercept of -17.5. To test this
formula on our data set:</p>
</div>
<div id="section-18" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-9" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># Use the coefficients from the Brown model
df_cancer_dx &lt;-
  df_cancer_dx %&gt;%
  mutate(
    logodds_brown = 0.75 * famhistory + 0.26 * age - 17.5,
    phat_brown = exp(logodds_brown) / (1 + exp(logodds_brown))
  )

# Run the decision curve
dca(cancer ~ phat_brown,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01),
    label = list(phat_brown = &quot;Brown Model&quot;)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-9" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Use the coefficients from the Brown model
g logodds_Brown = 0.75*(famhistory) + 0.26*(age) - 17.5

* Convert to predicted probability
g phat_Brown = invlogit(logodds_Brown)
label var phat_Brown &quot;Risk from Brown Model&quot;

* Run the decision curve
dca cancer phat_Brown, xstop(0.35) xlabel(0(0.05)0.35)</code></pre>
</div>
<div id="sas-9" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>DATA data_cancer;
  SET data_cancer;
  * use the coefficients from the Brown model;
  logodds_Brown = 0.75 * (famhistory) + 0.26 * (age) - 17.5;
  * convert to predicted probability;
  phat_Brown = exp(logodds_Brown) / (1 + exp(logodds_Brown));
RUN;

* run the decision curve;
%DCA(data = data_cancer, outcome = cancer, predictors = phat_Brown, xstop = 0.35);</code></pre>
</div>
<div id="python-9" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  df_cancer_dx[&#39;logodds_brown&#39;] = 0.75 * df_cancer_dx[&#39;famhistory&#39;] + 0.26*df_cancer_dx[&#39;age&#39;] - 17.5
  df_cancer_dx[&#39;phat_brown&#39;] = np.exp(df_cancer_dx[&#39;logodds_brown&#39;]) / (1 + np.exp(df_cancer_dx[&#39;logodds_brown&#39;]))
  
  dca_pub_model_df = \
      dca(
          data=df_cancer_dx,
          outcome=&#39;cancer&#39;,
          modelnames=[&#39;phat_brown&#39;],
          thresholds=np.arange(0,0.36,0.01),
      )
  
  plot_graphs(
      plot_df=dca_pub_model_df,
      y_limits=[-0.05, 0.2],
      graph_type=&#39;net_benefit&#39;
  )</code></pre>
</div>
</div>
<div id="section-19" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-pub_model-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>This decision curve suggests that although the model might be useful
in the most risk averse patients, it is actually harmful in patients
with more moderate threshold probabilities, that is, it has a net
benefit lower than a reasonable clinical alternative. As such, the Brown
et al. model should not be used in clinical practice. This effect, a
model being harmful, occurs due to miscalibration, that is, when
patients are given risks that are too high or too low. Note that
miscalibration only occurs rarely when models are created and tested on
the same data set, such as in the example where we created a model with
both family history and the marker.</p>
</div>
<div id="saving-out-net-benefit-values" class="section level4">
<h4>Saving out Net Benefit Values</h4>
<p>We can save out net benefit for a decision curve for further analysis
or presentation in a table. We simply need to specify the name of the
file we’d like it to be saved as. For a particular range of threshold
probabilities, we would only need to specify what threshold to start,
stop, and the increment we’d like to use. To assess or display the
increase in net benefit we’d simply need to subtract the net benefit of
the model based on treating all patients from the net benefit of our
model.</p>
<p>Let us imagine that we want to view the net benefit of using only the
marker to predict whether a patient has cancer, compared with the net
benefits of biopsying all patients at thresholds of 5%, 10%, 15% …
35%.</p>
<p>For the model itself, we would actually need to first specify that
the marker variable – unlike those of any of the models before – is not
a probability. Based on our thresholds, we’d want to begin at 0.05, and
by increments of 0.05, stop at 0.35. As we are not interested in the
graph, we can also specify to suppress the graph from being
displayed.</p>
</div>
<div id="section-20" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-10" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ marker,
    data = df_cancer_dx,
    as_probability = &quot;marker&quot;,
    thresholds = seq(0.05, 0.35, 0.15)
) %&gt;%
  as_tibble() %&gt;%
  select(label, threshold, net_benefit) %&gt;%
  gt::gt() %&gt;%
  gt::fmt_percent(columns = threshold, decimals = 0) %&gt;%
  gt::fmt(columns = net_benefit, fns = function(x) style_sigfig(x, digits = 3)) %&gt;%
  gt::cols_label(
    label = &quot;Strategy&quot;,
    threshold = &quot;Decision Threshold&quot;,
    net_benefit = &quot;Net Benefit&quot;
  ) %&gt;%
  gt::cols_align(&quot;left&quot;, columns = label)</code></pre>
</div>
<div id="stata-10" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Run the decision curve and save out net benefit results
* Specifying xby(.05) since we’d want 5% increments
dca cancer marker, prob(no) xstart(0.05) xstop(0.35) xby(0.05) nograph ///
 saving(&quot;DCA Output marker.dta&quot;, replace)

* Load the data set with the net benefit results
use &quot;DCA Output marker.dta&quot;, clear

* Calculate difference between marker and treat all
* Our standard approach is to biopsy everyone so this tells us
* how much better we do with the marker
g advantage = marker - all
label var advantage &quot;Increase in net benefit from using Marker model&quot;</code></pre>
</div>
<div id="sas-10" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* Run the decision curve and save out net benefit results, specify xby=0.05 since we want 5% increments;
%DCA(data = data_cancer, outcome = cancer, predictors = marker,
     probability = no, xstart = 0.05,
     xstop = 0.35, xby = 0.05, graph = no, out = dcamarker);

* Load the data set with the net benefit results;
DATA dcamarker;
  SET dcamarker;
  * Calculate difference between marker and treat all;
  * Our standard approach is to biopsy everyone so this tells us how much better we do with the marker;
  advantage = marker - all;
RUN;</code></pre>
</div>
<div id="python-10" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  dca_table_df = \
      dca(
          data=df_cancer_dx,
          outcome=&#39;cancer&#39;,
          modelnames=[&#39;marker&#39;],
          models_to_prob=[&#39;marker&#39;],
          thresholds=np.arange(0.05, 0.36, 0.15)
      )
  
  print(&#39;\n&#39;, dca_table_df[[&#39;model&#39;, &#39;threshold&#39;, &#39;net_benefit&#39;]])</code></pre>
</div>
</div>
<div id="section-21" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<div id="ntzkscefds" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ntzkscefds .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ntzkscefds .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ntzkscefds .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ntzkscefds .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ntzkscefds .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ntzkscefds .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntzkscefds .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ntzkscefds .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ntzkscefds .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ntzkscefds .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ntzkscefds .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ntzkscefds .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ntzkscefds .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ntzkscefds .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ntzkscefds .gt_from_md > :first-child {
  margin-top: 0;
}

#ntzkscefds .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ntzkscefds .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ntzkscefds .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ntzkscefds .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ntzkscefds .gt_row_group_first td {
  border-top-width: 2px;
}

#ntzkscefds .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntzkscefds .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ntzkscefds .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ntzkscefds .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntzkscefds .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntzkscefds .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ntzkscefds .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ntzkscefds .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ntzkscefds .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ntzkscefds .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntzkscefds .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ntzkscefds .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ntzkscefds .gt_left {
  text-align: left;
}

#ntzkscefds .gt_center {
  text-align: center;
}

#ntzkscefds .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ntzkscefds .gt_font_normal {
  font-weight: normal;
}

#ntzkscefds .gt_font_bold {
  font-weight: bold;
}

#ntzkscefds .gt_font_italic {
  font-style: italic;
}

#ntzkscefds .gt_super {
  font-size: 65%;
}

#ntzkscefds .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ntzkscefds .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ntzkscefds .gt_indent_1 {
  text-indent: 5px;
}

#ntzkscefds .gt_indent_2 {
  text-indent: 10px;
}

#ntzkscefds .gt_indent_3 {
  text-indent: 15px;
}

#ntzkscefds .gt_indent_4 {
  text-indent: 20px;
}

#ntzkscefds .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Strategy">Strategy</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Decision Threshold">Decision Threshold</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Net Benefit">Net Benefit</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Treat All</td>
<td headers="threshold" class="gt_row gt_right">5%</td>
<td headers="net_benefit" class="gt_row gt_right">0.095</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Treat All</td>
<td headers="threshold" class="gt_row gt_right">20%</td>
<td headers="net_benefit" class="gt_row gt_right">-0.075</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Treat All</td>
<td headers="threshold" class="gt_row gt_right">35%</td>
<td headers="net_benefit" class="gt_row gt_right">-0.323</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Treat None</td>
<td headers="threshold" class="gt_row gt_right">5%</td>
<td headers="net_benefit" class="gt_row gt_right">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Treat None</td>
<td headers="threshold" class="gt_row gt_right">20%</td>
<td headers="net_benefit" class="gt_row gt_right">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Treat None</td>
<td headers="threshold" class="gt_row gt_right">35%</td>
<td headers="net_benefit" class="gt_row gt_right">0.000</td></tr>
    <tr><td headers="label" class="gt_row gt_left">marker</td>
<td headers="threshold" class="gt_row gt_right">5%</td>
<td headers="net_benefit" class="gt_row gt_right">0.095</td></tr>
    <tr><td headers="label" class="gt_row gt_left">marker</td>
<td headers="threshold" class="gt_row gt_right">20%</td>
<td headers="net_benefit" class="gt_row gt_right">0.029</td></tr>
    <tr><td headers="label" class="gt_row gt_left">marker</td>
<td headers="threshold" class="gt_row gt_right">35%</td>
<td headers="net_benefit" class="gt_row gt_right">0.007</td></tr>
  </tbody>
  
  
</table>
</div>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>The saved table lists the range of threshold probability that we
specified, followed by the net benefits of treating all, none, our
specified model, intervention avoided (we discuss this below), and the
newly created variable which represent the increase in net benefits of
our model using only the marker.</p>
<p>Net benefit has a ready clinical interpretation. The value of 0.03 at
a threshold probability of 20% can be interpreted as: “Comparing to
conducting no biopsies, biopsying on the basis of the marker is the
equivalent of a strategy that found 3 cancers per hundred patients
without conducting any unnecessary biopsies.”</p>
</div>
<div id="interventions-avoided" class="section level4">
<h4>Interventions Avoided</h4>
<p>In many cases, the default clinical strategy is to intervene on all
patients, and thus the aim of a model or marker is to help reduce
unnecessary interventions. In contrast to the traditional method, where
net benefit is calculated in terms of the net increase in true positives
compared to no treatment, we can also calculate net benefit in terms of
a net decrease in false positives compared to the “treat all” strategy.
In our cancer biopsy example, for instance, we might interested in
whether we could reduce the number of biopsies. in the table that was
saved out. To view decrease in interventions graphically, we would only
need to specify it in our command.</p>
</div>
<div id="section-22" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-11" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(cancer ~ marker,
    data = df_cancer_dx,
    as_probability = &quot;marker&quot;,
    thresholds = seq(0.05, 0.35, 0.01),
    label = list(marker = &quot;Marker&quot;)
) %&gt;%
  net_intervention_avoided() %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-11" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* import data
import delimited &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&quot;, clear
label variable marker &quot;Marker&quot;

* net interventions avoided
dca cancer marker, prob(no) intervention xstart(0.05) xstop(0.35)</code></pre>
</div>
<div id="sas-11" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer, predictors = marker, probability = no,
     intervention = yes, xstart = 0.05, xstop = 0.35);</code></pre>
</div>
<div id="python-11" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  dca_intervention_df = \
      dca(
          data=df_cancer_dx,
          outcome=&#39;cancer&#39;,
          modelnames=[&#39;marker&#39;],
          thresholds=np.arange(0.05, 0.36, 0.01),
          models_to_prob=[&#39;marker&#39;]
      )
  
  plot_graphs(
      plot_df=dca_intervention_df,
      graph_type=&#39;net_intervention_avoided&#39;
  )</code></pre>
</div>
</div>
<div id="section-23" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_intervention-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>At a probability threshold of 10%, the net reduction in interventions
is about 0.15. In other words, at this probability threshold, biopsying
patients on the basis of the marker is the equivalent of a strategy that
led to an absolute 15% reduction in the number of biopsies without
missing any cancers. You can also report the net interventions avoided
per 100 patients (or any number of patients).</p>
</div>
</div>
</div>
<div id="survival-outcomes" class="section level2">
<h2>Survival Outcomes</h2>
<div id="motivating-example-1" class="section level3">
<h3>Motivating Example</h3>
<p>Patients had a marker measured and were followed to determine whether
they were eventually diagnosed with cancer, as well as the time to that
diagnosis or censoring. We want to build a model of our own based on
age, family history, and the marker, and assess how well the model
predicts cancer diagnosis within 1.5 years.</p>
</div>
<div id="basic-data-set-up" class="section level3">
<h3>Basic Data Set-up</h3>
<p>We first need to import our data.</p>
<div id="section-24" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-12" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># import data
df_time_to_cancer_dx &lt;-
  readr::read_csv(
    file = &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_time_to_cancer_dx.csv&quot;
  ) %&gt;%
  # assign variable labels. these labels will be carried through in the `dca()` output
  labelled::set_variable_labels(
    patientid = &quot;Patient ID&quot;,
    cancer = &quot;Cancer Diagnosis&quot;,
    ttcancer = &quot;Years to Diagnosis/Censor&quot;,
    risk_group = &quot;Risk Group&quot;,
    age = &quot;Patient Age&quot;,
    famhistory = &quot;Family History&quot;,
    marker = &quot;Marker&quot;,
    cancerpredmarker = &quot;Prediction Model&quot;,
    cancer_cr = &quot;Cancer Diagnosis Status&quot;
  )</code></pre>
</div>
<div id="stata-12" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* import data
import delimited &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_time_to_cancer_dx.csv&quot;, clear

* assign variable labels. these labels will be carried through in the DCA output
label variable patientid &quot;Patient ID&quot;
label variable cancer &quot;Cancer Diagnosis&quot;
label variable ttcancer &quot;Years to Diagnosis/Censor&quot;
label variable risk_group &quot;Risk Group&quot;
label variable age &quot;Patient Age&quot;
label variable famhistory &quot;Family History&quot;
label variable marker &quot;Marker&quot;
label variable cancerpredmarker &quot;Prediction Model&quot;
label variable cancer_cr &quot;Cancer Diagnosis Status&quot;

* Declaring survival time data: follow-up time variable is ttcancer and the event is cancer
stset ttcancer, f(cancer)</code></pre>
</div>
<div id="sas-12" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>FILENAME ttcancer URL &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_time_to_cancer_dx.csv&quot;;

PROC IMPORT FILE = ttcancer OUT = work.data_ttcancer DBMS = CSV;
RUN;

DATA data_ttcancer;
  SET data_ttcancer;

  LABEL patientid = &quot;Patient ID&quot;
        cancer = &quot;Cancer Diagnosis&quot;
        ttcancer = &quot;Years to Diagnosis/Censor&quot;
        risk_group = &quot;Risk Group&quot;
        age = &quot;Patient Age&quot;
        famhistory = &quot;Family History&quot;
        marker = &quot;Marker&quot;
        cancerpredmarker = &quot;Prediction Model&quot;
        cancer_cr = &quot;Cancer Diagnosis Status&quot;;

RUN;</code></pre>
</div>
<div id="python-12" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  df_time_to_cancer_dx = \
      pd.read_csv(
          &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_time_to_cancer_dx.csv&quot;
      )</code></pre>
</div>
</div>
<div id="section-25" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>The survival probability to any time-point can be derived from any
type of survival model; here we use a Cox as this is the most common
model in statistical practice. You don’t necessarily need to know this
to run a decision curve, but the formula for a survival probability from
a Cox model is given by:</p>
<p><span class="math display">\[
S(t|X) = S_0(t)^{e^{X\beta}}
\]</span></p>
<p>Where <span class="math inline">\(X\)</span> is matrix of covariates
in the Cox model, <span class="math inline">\(\beta\)</span> is a vector
containing the parameter estimates from the Cox model, and <span
class="math inline">\(S_0(t)\)</span> is the baseline survival
probability to time t.</p>
<p>To run a decision curve analysis, we will create a Cox model with
age, family history, and the marker, as predictors, save out the
baseline survival function in a new variable, and obtaining the linear
prediction from the model for each subject.</p>
<p>We then obtain the baseline survival probability to our time point of
interest. If no patient was observed at the exact time of interest, we
can use the baseline survival probability to the observed time closest
to, but not after, the time point. We can then calculate the probability
of failure at the specified time point. For our example, we will use a
time point of 1.5, which would corresponds to the eighteen months that
we are interested in.</p>
</div>
<div id="section-26" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-13" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># Load survival library
library(survival)

# Run the cox model
coxmod &lt;- coxph(Surv(ttcancer, cancer) ~ age + famhistory + marker, data = df_time_to_cancer_dx)

df_time_to_cancer_dx &lt;-
  df_time_to_cancer_dx %&gt;%
  mutate(
    pr_failure18 =
      1 - summary(survfit(coxmod, newdata = df_time_to_cancer_dx), times = 1.5)$surv[1, ]
  )</code></pre>
</div>
<div id="stata-13" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Run the cox model and save out baseline survival in the “surv_func” variable
stcox age famhistory marker, basesurv(surv_func)

* get linear predictor for calculation of risk
predict xb, xb

* Obtain baseline survival at 1.5 years = 18 months
sum surv_func if _t &lt;= 1.5

* We want the survival closest to 1.5 years
* This will be the lowest survival rate for all survival times ≤1.5
local base = r(min)

* Convert to a probability
g pr_failure18 = 1 - `base&#39;^exp(xb)
label var pr_failure18 &quot;Probability of Failure at 18 months&quot;</code></pre>
</div>
<div id="sas-13" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* Run the Cox model;
PROC PHREG DATA=data_ttcancer;
  MODEL ttcancer*cancer(0) = age famhistory marker;
  BASELINE OUT=baseline COVARIATES=data_ttcancer SURVIVAL=surv_func / NOMEAN METHOD=pl;
RUN;

* the probability of failure at 1.5 years is calculated by subtracting the probability of survival from 1;
PROC SQL NOPRINT UNDO_POLICY=none;
  CREATE TABLE base_surv2 AS
  SELECT DISTINCT
  patientid, age, famhistory, marker, 1-min(surv_func) AS pr_failure18
  FROM baseline (WHERE=(ttcancer&lt;=1.5))
  GROUP BY patientid, age, famhistory, marker
  ;

  * merge survival estimates with original data;
  CREATE TABLE data_ttcancer AS
  SELECT A.*, B.pr_failure18
  FROM data_ttcancer A
  LEFT JOIN base_surv2 B
    ON (A.patientid=B.patientid) and (A.age=B.age) and
    (A.famhistory=B.famhistory) and (A.marker=B.marker);
  ;
QUIT;

DATA data_ttcancer;
  SET data_ttcancer;
  LABEL pr_failure18 = &quot;Probability of Failure at 18 months&quot;;
RUN;</code></pre>
</div>
<div id="python-13" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  cph = lifelines.CoxPHFitter()
  cph.fit(df=df_time_to_cancer_dx,
          duration_col=&#39;ttcancer&#39;,
          event_col=&#39;cancer&#39;,
          formula=&#39;age + famhistory + marker&#39;)
  
  cph_pred_vals = \
      cph.predict_survival_function(
          df_time_to_cancer_dx[[&#39;age&#39;,
                                &#39;famhistory&#39;,
                                &#39;marker&#39;]],
          times=[1.5])
  
  df_time_to_cancer_dx[&#39;pr_failure18&#39;] = [1 - val for val in cph_pred_vals.iloc[0, :]]</code></pre>
</div>
</div>
<div id="section-27" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>The code for running the decision curve analysis is straightforward
after the probability of failure is calculated. All we have to do is
specify the time point we are interested in. For our example, let us not
only set the threshold from 0% to 50%, but also add smoothing.</p>
</div>
<div id="section-28" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-14" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(Surv(ttcancer, cancer) ~ pr_failure18,
    data = df_time_to_cancer_dx,
    time = 1.5,
    thresholds = seq(0, 0.5, 0.01),
    label = list(pr_failure18 = &quot;Prediction Model&quot;)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-14" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>stdca pr_failure18, timepoint(1.5) xstop(0.5) smooth</code></pre>
</div>
<div id="sas-14" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%STDCA(data = data_ttcancer, out = survivalmult,
       outcome = cancer, ttoutcome = ttcancer,
       timepoint = 1.5, predictors = pr_failure18, xstop = 0.5);</code></pre>
</div>
<div id="python-14" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  stdca_coxph_results = \
          dca(
              data=df_time_to_cancer_dx,
              outcome=&#39;cancer&#39;,
              modelnames=[&#39;pr_failure18&#39;],
              thresholds=np.arange(0, 0.51, 0.01),
              time=1.5,
              time_to_outcome_col=&#39;ttcancer&#39;
          )
  
  plot_graphs(
    plot_df=stdca_coxph_results,
    graph_type=&#39;net_benefit&#39;,
    y_limits=[-0.05, 0.25]
  )</code></pre>
</div>
</div>
<div id="section-29" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-stdca_coxph-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>This shows that using the model to inform clinical decisions will
lead to superior outcomes for any decision associated with a threshold
probability of above 2% or so.</p>
</div>
</div>
<div id="competing-risks" class="section level3">
<h3>Competing Risks</h3>
<p>At times, data sets are subject to competing risks. For example in
our cancer data set, patients may have died prior to cancer diagnosis.
To run a competing risk analysis, we first create a failure variable
that indicates which patients died before a cancer diagnosis and then
run a survival time decision curve analysis.</p>
<div id="section-30" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-15" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># status variable must be a factor with first level coded as &#39;censor&#39;,
# and the second level the outcome of interest.
df_time_to_cancer_dx &lt;-
  df_time_to_cancer_dx %&gt;%
  mutate(
    cancer_cr =
      factor(cancer_cr,
             levels = c(&quot;censor&quot;, &quot;diagnosed with cancer&quot;, &quot;dead other causes&quot;)
      )
  )

dca(Surv(ttcancer, cancer_cr) ~ pr_failure18,
    data = df_time_to_cancer_dx,
    time = 1.5,
    thresholds = seq(0, 0.5, 0.01),
    label = list(pr_failure18 = &quot;Prediction Model&quot;)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-15" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Define the competing events status variable
g status = 0 if cancer_cr == &quot;censor&quot;
    replace status = 1 if cancer_cr == &quot;dead other causes&quot;
    replace status = 2 if cancer_cr == &quot;diagnosed with cancer&quot;

* We declare our survival data with the new event variable
stset ttcancer, f(status=1)

* Run the decision curve specifying the competing risk option
stdca pr_failure18, timepoint(1.5) compet1(2) smooth xstop(.5)</code></pre>
</div>
<div id="sas-15" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* Define the competing events status variable;
DATA data_ttcancer;
  SET data_ttcancer;
  status = 0;
  IF cancer_cr = &quot;diagnosed with cancer&quot; THEN status=1;
  ELSE IF cancer_cr = &quot;dead other causes&quot; THEN status=2;
RUN;

* Run the decision curve specifying the competing risk option;
%STDCA(data = data_ttcancer, outcome = status,
       ttoutcome = ttcancer, timepoint = 1.5,
       predictors = pr_failure18, competerisk = yes, xstop = 0.5);</code></pre>
</div>
<div id="python-15" class="section level5">
<h5>Python</h5>
<pre class="python"><code># Coming Soon!</code></pre>
</div>
</div>
<div id="section-31" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-stdca_cmprsk-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
</div>
</div>
</div>
<div id="case-control-designs" class="section level2">
<h2>Case-Control Designs</h2>
<p>An issue with applying decision curve analysis to case-control data
is that net benefit depends on prevalence, and prevalence in
case-control studies is fixed by design. When working with case-control
data, you can pass the population prevalence to accurately calculate the
net benefit.</p>
<div id="section-32" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-16" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># import data
df_cancer_dx_case_control &lt;-
  readr::read_csv(
    file = &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx_case_control.csv&quot;
  ) %&gt;%
  # assign variable labels. these labels will be carried through in the `dca()` output
  labelled::set_variable_labels(
    patientid = &quot;Patient ID&quot;,
    casecontrol = &quot;Case-Control Status&quot;,
    risk_group = &quot;Risk Group&quot;,
    age = &quot;Patient Age&quot;,
    famhistory = &quot;Family History&quot;,
    marker = &quot;Marker&quot;,
    cancerpredmarker = &quot;Prediction Model&quot;
  )

# summarize data
df_cancer_dx_case_control %&gt;%
  select(-patientid) %&gt;%
  tbl_summary(
    by = casecontrol,
    type = all_dichotomous() ~ &quot;categorical&quot;
  ) %&gt;%
  modify_spanning_header(all_stat_cols() ~ &quot;**Case-Control Status**&quot;)</code></pre>
</div>
<div id="stata-16" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* import data
import delimited &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx_case_control.csv&quot;, clear

label variable patientid &quot;Patient ID&quot;
label variable casecontrol &quot;Case-Control Status&quot;
label variable risk_group &quot;Risk Group&quot;
label variable age &quot;Patient Age&quot;
label variable famhistory &quot;Family History&quot;
label variable marker &quot;Marker&quot;
label variable cancerpredmarker &quot;Probability of Cancer Diagnosis&quot;</code></pre>
</div>
<div id="sas-16" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>FILENAME case_con URL &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx_case_control.csv&quot;;

PROC IMPORT FILE = case_con OUT = work.data_case_control DBMS = CSV;
RUN;

DATA data_case_control;
  SET data_case_control;

  LABEL patientid = &quot;Patient ID&quot;
        casecontrol = &quot;Case-Control Status&quot;
        risk_group = &quot;Risk Group&quot;
        age = &quot;Patient Age&quot;
        famhistory = &quot;Family History&quot;
        marker = &quot;Marker&quot;
        cancerpredmarker = &quot;Probability of Cancer Diagnosis&quot;;
RUN;</code></pre>
</div>
<div id="python-16" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  df_case_control = \
    pd.read_csv(
                &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx_case_control.csv&quot;
            )
 
  # Summarize Data With Column Medians
  medians = df_case_control.drop(columns=&#39;patientid&#39;).groupby([&#39;casecontrol&#39;]).median()
  print(&#39;\n&#39;, medians.to_string())</code></pre>
</div>
</div>
<div id="section-33" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<div id="ofcnpcguhw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ofcnpcguhw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 13px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ofcnpcguhw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ofcnpcguhw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ofcnpcguhw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ofcnpcguhw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ofcnpcguhw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ofcnpcguhw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ofcnpcguhw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ofcnpcguhw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ofcnpcguhw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ofcnpcguhw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ofcnpcguhw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ofcnpcguhw .gt_group_heading {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ofcnpcguhw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ofcnpcguhw .gt_from_md > :first-child {
  margin-top: 0;
}

#ofcnpcguhw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ofcnpcguhw .gt_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ofcnpcguhw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ofcnpcguhw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ofcnpcguhw .gt_row_group_first td {
  border-top-width: 2px;
}

#ofcnpcguhw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ofcnpcguhw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ofcnpcguhw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ofcnpcguhw .gt_last_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ofcnpcguhw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ofcnpcguhw .gt_first_grand_summary_row {
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ofcnpcguhw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ofcnpcguhw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ofcnpcguhw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ofcnpcguhw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 1px;
  padding-right: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ofcnpcguhw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ofcnpcguhw .gt_sourcenote {
  font-size: 90%;
  padding-top: 1px;
  padding-bottom: 1px;
  padding-left: 5px;
  padding-right: 5px;
}

#ofcnpcguhw .gt_left {
  text-align: left;
}

#ofcnpcguhw .gt_center {
  text-align: center;
}

#ofcnpcguhw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ofcnpcguhw .gt_font_normal {
  font-weight: normal;
}

#ofcnpcguhw .gt_font_bold {
  font-weight: bold;
}

#ofcnpcguhw .gt_font_italic {
  font-style: italic;
}

#ofcnpcguhw .gt_super {
  font-size: 65%;
}

#ofcnpcguhw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ofcnpcguhw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ofcnpcguhw .gt_indent_1 {
  text-indent: 5px;
}

#ofcnpcguhw .gt_indent_2 {
  text-indent: 10px;
}

#ofcnpcguhw .gt_indent_3 {
  text-indent: 15px;
}

#ofcnpcguhw .gt_indent_4 {
  text-indent: 20px;
}

#ofcnpcguhw .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2" scope="colgroup" id="&lt;strong&gt;Case-Control Status&lt;/strong&gt;">
        <span class="gt_column_spanner"><strong>Case-Control Status</strong></span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;0&lt;/strong&gt;, N = 330&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>0</strong>, N = 330<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;1&lt;/strong&gt;, N = 420&lt;sup class=&quot;gt_footnote_marks&quot;&gt;1&lt;/sup&gt;"><strong>1</strong>, N = 420<sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">Risk Group</td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    high</td>
<td headers="stat_1" class="gt_row gt_center">5 (1.5%)</td>
<td headers="stat_2" class="gt_row gt_center">16 (3.8%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    intermediate</td>
<td headers="stat_1" class="gt_row gt_center">120 (36%)</td>
<td headers="stat_2" class="gt_row gt_center">215 (51%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    low</td>
<td headers="stat_1" class="gt_row gt_center">205 (62%)</td>
<td headers="stat_2" class="gt_row gt_center">189 (45%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Patient Age</td>
<td headers="stat_1" class="gt_row gt_center">64.0 (60.9, 67.0)</td>
<td headers="stat_2" class="gt_row gt_center">65.8 (61.9, 69.1)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Family History</td>
<td headers="stat_1" class="gt_row gt_center"></td>
<td headers="stat_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">    0</td>
<td headers="stat_1" class="gt_row gt_center">292 (88%)</td>
<td headers="stat_2" class="gt_row gt_center">343 (82%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">    1</td>
<td headers="stat_1" class="gt_row gt_center">38 (12%)</td>
<td headers="stat_2" class="gt_row gt_center">77 (18%)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Marker</td>
<td headers="stat_1" class="gt_row gt_center">0.58 (0.26, 1.10)</td>
<td headers="stat_2" class="gt_row gt_center">0.71 (0.32, 1.57)</td></tr>
    <tr><td headers="label" class="gt_row gt_left">Prediction Model</td>
<td headers="stat_1" class="gt_row gt_center">0.04 (0.02, 0.11)</td>
<td headers="stat_2" class="gt_row gt_center">0.09 (0.03, 0.27)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="3"><sup class="gt_footnote_marks">1</sup> n (%); Median (IQR)</td>
    </tr>
  </tfoot>
</table>
</div>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>In the example below, the population prevalence is 20%.</p>
</div>
<div id="section-34" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-17" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code>dca(casecontrol ~ cancerpredmarker,
    data = df_cancer_dx_case_control,
    prevalence = 0.20,
    thresholds = seq(0, 0.5, 0.01)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-17" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca casecontrol cancerpredmarker, prevalence(0.20) xstop(0.50)</code></pre>
</div>
<div id="sas-17" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_case_control, outcome = casecontrol,
     predictors = cancerpredmarker, prevalence = 0.20);</code></pre>
</div>
<div id="python-17" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  dca_case_control_df = \
    dca(
      data=df_case_control,
      outcome=&#39;casecontrol&#39;,
      modelnames=[&#39;cancerpredmarker&#39;],
      prevalence=0.20,
      thresholds=np.arange(0, 0.51, 0.01)
    )
  
  plot_graphs(
    plot_df=dca_case_control_df,
    graph_type=&#39;net_benefit&#39;,
    y_limits=[-0.05, 0.25]
  )</code></pre>
</div>
</div>
<div id="section-35" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_case_control-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>The interpretation of the decision curve analysis figure is the same
as for a cohort study. In this example, the model performs worse than a
biopsy all strategy from threshold 0% to 17%, and the model has benefit
from 18% to 40%. As the model does not have the highest net benefit
across the full range of reasonable threshold probabilities, it is not
justified to use it in practice.</p>
</div>
</div>
<div id="incorporating-harms" class="section level2">
<h2>Incorporating Harms</h2>
<p>To incorporate the harm associated with obtaining the marker, we ask
a clinician, who tells us that, even if the marker were perfectly
accurate, few clinicians would conduct more than 30 tests to predict one
cancer diagnosis. This might be because the test is expensive, or
requires some invasive procedure to obtain. The “harm” of measuring the
marker is the reciprocal of 30, or 0.0333.</p>
<div id="section-36" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-18" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># Run the decision curve
dca(cancer ~ marker,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01),
    as_probability = &quot;marker&quot;,
    harm = list(marker = 0.0333)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-18" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>dca cancer high_risk, probability(no) harm(0.0333) xstop(0.35) xlabel(0(0.05)0.35)</code></pre>
</div>
<div id="sas-18" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%DCA(data = data_cancer, outcome = cancer,
     predictors = risk_group,
     probability=no,
     harm = 0.0333,
     graph = yes, xstop = 0.35);</code></pre>
</div>
<div id="python-18" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  dca_harm_simple_df = \
      dca(
          data=df_cancer_dx,
          outcome=&#39;cancer&#39;,
          modelnames=[&#39;marker&#39;],
          thresholds=np.arange(0, 0.36, 0.01),
          harm={&#39;marker&#39;: 0.0333},
          models_to_prob=[&#39;marker&#39;]
      )
  
  plot_graphs(
      plot_df=dca_harm_simple_df,
      graph_type=&#39;net_benefit&#39;
  )</code></pre>
</div>
</div>
<div id="section-37" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-dca_harm_simple-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>This shows the net benefit of the model is no longer superior across
the full range of reasonable threshold probabilities. Hence the benefit
of using the model does not outweigh the harm of having to collect the
marker needed by the model.</p>
<p>Many decisions in medicine are based on conditional test results,
however. A classic example is where patients are categorized on the
basis of a test as being at high, low or intermediate risk. Patients at
high risk are referred immediately for treatment (in our example
biopsied); patients at low risk are reassured and advised that no
further action is necessary; patients at intermediate risk are sent for
an additional test, with subsequent treatment decisions made
accordingly.</p>
<p>We have to calculate harm specially for the conditional test, because
only patients at intermediate risk are measured for the marker. Then
incorporate it into our decision curve. The strategy for incorporating
harm for the conditional test is by multiplying the proportion scanned
by the harm of the scan.</p>
</div>
<div id="section-38" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-19" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># the harm of measuring the marker is stored in a scalar
harm_marker &lt;- 0.0333
# in the conditional test, only patients at intermediate risk
# have their marker measured
# harm of the conditional approach is proportion of patients who have the marker
# measured multiplied by the harm
harm_conditional &lt;- mean(df_cancer_dx$risk_group == &quot;intermediate&quot;) * harm_marker

# Run the decision curve
dca(cancer ~ risk_group,
    data = df_cancer_dx,
    thresholds = seq(0, 0.35, 0.01),
    as_probability = &quot;risk_group&quot;,
    harm = list(risk_group = harm_conditional)
) %&gt;%
  plot(smooth = TRUE)</code></pre>
</div>
<div id="stata-19" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* the harm of measuring the marker is stored in a local
local harm_marker = 0.0333
* in the conditional test, only patients at intermediate risk have their marker measured
g intermediate_risk = (risk_group==&quot;intermediate&quot;)

* harm of the conditional approach is proportion of patients who have the marker measured multiplied by the harm
sum intermediate_risk
local harm_conditional = r(mean)*`harm_marker&#39;

* Run the decision curve
dca cancer high_risk joint conditional, ///
 probability(no) harm(`harm_conditional&#39;) xstop(0.35) xlabel(0(0.05)0.35)</code></pre>
</div>
<div id="sas-19" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>* the harm of measuring the marker is stored as a macro variable;
%LET harm_marker = 0.0333;

*in the conditional test, only patients at intermediate risk have their marker measured;
DATA data_cancer;
  SET data_cancer;
  intermediate_risk = (risk_group = &quot;intermediate&quot;);
RUN;

* calculate the proportion of patients who have the marker and save out mean risk;
PROC MEANS DATA = data_cancer;
 VAR intermediate_risk;
 OUTPUT OUT = meanrisk MEAN = meanrisk;
RUN;

DATA _NULL_;
  SET meanrisk;
  CALL SYMPUT(&quot;meanrisk&quot;, meanrisk);
RUN;

* harm of the conditional approach is proportion of patients who have the marker measured multiplied by the harm;
%LET harm_conditional = %SYSEVALF(&amp;meanrisk.*&amp;harm_marker.);

* Run the decision curve;
%DCA(data = data_cancer, outcome = cancer, predictors = high_risk,
     probability=no,
     harm = &amp;harm_conditional., xstop = 0.35);</code></pre>
</div>
<div id="python-19" class="section level5">
<h5>Python</h5>
<pre class="python"><code>  harm_marker = 0.0333
  harm_conditional = (df_cancer_dx[&#39;risk_group&#39;] == &quot;intermediate&quot;).mean() * harm_marker
  
  dca_harm_df = \
      dca(
          data=df_cancer_dx,
          outcome=&#39;cancer&#39;,
          modelnames=[&#39;risk_group&#39;],
          models_to_prob=[&#39;risk_group&#39;],
          thresholds=np.arange(0, 0.36, 0.01),
          harm={&#39;risk_group&#39;: harm_conditional}
      )
  
  plot_graphs(
      plot_df=dca_harm_df
  )</code></pre>
</div>
</div>
<div id="section-39" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
</div>
</div>
<div id="correction-for-overfit" class="section level2">
<h2>Correction for Overfit</h2>
<p>As is well known, evaluating a model on the same data set that was
used to generate the model will give overoptimistic estimates of model
performance. One way to correct for this sort of overfit is by using
10-fold cross validation. The key steps are as follows:</p>
<ol style="list-style-type: decimal">
<li>Randomly divide the data set into 10 groups of equal size, with
equal numbers of events in each group.</li>
<li>Fit the model using all but the first group.</li>
<li>Apply the model created from all observations other than those in
the first group (in step 2), to the first group to obtain the predicted
probability of the event.</li>
<li>Repeat steps (2) and (3) leaving out and then applying the fitted
model for each of the groups. Every subject now has a predicted
probability of the event derived from a model that was generated from a
data set that did not include that subject.</li>
<li>Using the predicted probabilities, compute the net benefit at
various threshold probabilities.</li>
<li>One approach is to repeat this process many times and take an
average (repeated 10-fold cross validation). Although this is not always
done, we will include code for it here. Repeat steps (1) to (5) 200
times. The corrected net benefit for each threshold probability is the
mean across the 200 replications.</li>
</ol>
<div id="section-40" class="section level4 tabset tabset-pills">
<h4 class="tabset tabset-pills"></h4>
<div id="r-20" class="section level5 active">
<h5 class="active">R</h5>
<pre class="r"><code># set seed for random process
set.seed(112358)

# create a 10-fold cross validation set
rsample::vfold_cv(df_cancer_dx, v = 10, repeats = 25) %&gt;%
  # for each cut of the data, build logistic regression on the 90% (analysis set),
  # and perform DCA on the 10% (assessment set)
  rowwise() %&gt;%
  mutate(
    # build regression model on analysis set
    glm_analysis =
      glm(cancer ~ marker + age + famhistory,
          data = rsample::analysis(splits),
          family = binomial
      ) %&gt;%
      list(),
    # get predictions for assessment set
    df_assessment =
      broom::augment(
        glm_analysis,
        newdata = rsample::assessment(splits),
        type.predict = &quot;response&quot;
      ) %&gt;%
      list(),
    # calculate net benefit on assessment set
    dca_assessment =
      dca(cancer ~ .fitted,
          data = df_assessment,
          thresholds = seq(0, 0.35, 0.01),
          label = list(.fitted = &quot;Cross-validated Prediction Model&quot;)
      ) %&gt;%
      as_tibble() %&gt;%
      list()
  ) %&gt;%
  # pool results from the 10-fold cross validation
  pull(dca_assessment) %&gt;%
  bind_rows() %&gt;%
  group_by(variable, label, threshold) %&gt;%
  summarise(net_benefit = mean(net_benefit), .groups = &quot;drop&quot;) %&gt;%
  # plot cross validated net benefit values
  ggplot(aes(x = threshold, y = net_benefit, color = label)) +
  stat_smooth(method = &quot;loess&quot;, se = FALSE, formula = &quot;y ~ x&quot;, span = 0.2) +
  coord_cartesian(ylim = c(-0.014, 0.14)) +
  scale_x_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(x = &quot;Threshold Probability&quot;, y = &quot;Net Benefit&quot;, color = &quot;&quot;) +
  theme_bw()</code></pre>
</div>
<div id="stata-20" class="section level5">
<h5>Stata</h5>
<pre class="stata"><code>* Load Original Dataset
import delimited &quot;https://raw.githubusercontent.com/ddsjoberg/dca-tutorial/main/data/df_cancer_dx.csv&quot;, clear

* To skip this optional loop used for running the cross validation multiple times
* either 1) change it to “forvalues i=1(1)1 {” or
* 2) omit this line of code and take care to change any code which references “i”
forvalues i=1(1)2 {
  * Local macros to store the names of model.
  local prediction1 = &quot;model&quot;
  * Create variables to later store probabilities from each prediction model
  quietly g `prediction1&#39;=.

  * Create a variable to be used to ‘randomize’ the patients.
  quietly g u = uniform()
  * Sort by the event to ensure equal number of patients with the event are in each
  * group
  sort cancer u
  * Assign each patient into one of ten groups
  g group = mod(_n, 10) + 1

  * Loop through to run through for each of the ten groups
  forvalues j=1(1)10 {
    * First for the “base” model:
    * Fit the model excluding the jth group.
    quietly logit cancer age famhistory marker if group!=`j&#39;
    * Predict the probability of the jth group.
    quietly predict ptemp if group==`j&#39;
    * Store the predicted probabilities of the jth group (that was not used in
    * creating the model) into the variable previously created
    quietly replace `prediction1&#39; = ptemp if group==`j&#39;
    * Dropping the temporary variable that held predicted probabilities for all
    * patients
    drop ptemp
  }

  * Creating a temporary file to store the results of each of the iterations of our
  * decision curve for the multiple the 10 fold cross validation
  * This step may omitted if the optional forvalues loop was excluded.
  tempfile dca`i&#39;

  * Run decision curve, and save the results to the tempfile.
  * For those excluding the optional multiple cross validation, this decision curve
  * (to be seen by excluding “nograph”) and the results (saved under the name of your
  * choosing) would be the decision curve corrected for overfit.
  quietly dca cancer `prediction1&#39;, xstop(.5) nograph ///
  saving(&quot;`dca`i&#39;&#39;&quot;)
  drop u group `prediction1&#39;
} // This closing bracket ends the initial loop for the multiple cross validation.

* It is also necessary for those who avoided the multiple cross validation
* by changing the value of the forvalues loop from 200 to 1*/
* The following is only used for the multiple 10 fold cross validations.
use &quot;`dca1&#39;&quot;, clear
forvalues i=2(1)2 {
  * Append all values of the multiple cross validations into the first file
  append using &quot;`dca`i&#39;&#39;&quot;
}

* Calculate the average net benefit across all iterations of the multiple
* cross validation
collapse all none model model_i, by(threshold)
save &quot;Cross Validation DCA Output.dta&quot;, replace

* Labeling the variables so that the legend will have the proper labels
label var all &quot;Treat All&quot;
label var none &quot;Treat None&quot;
label var model &quot;Cross-validated Prediction Model&quot;

* Plotting the figure of all the net benefits.
twoway (line all threshold if all&gt;-0.05, sort) || (line none model threshold, sort)</code></pre>
</div>
<div id="sas-20" class="section level5">
<h5>SAS</h5>
<pre class="sas"><code>%MACRO CROSSVAL(data=,             /*Name of input dataset*/
                out=,              /*Name of output dataset containing calculated net benefit*/
                outcome=,          /*outcome variable, 1=event, 0=nonevent*/
                predictors=,       /*Covariates in the model*/
                v = 10,            /*number of folds in the cross validation*/
                repeats = 200,     /*Number of repeated cross validations that will be run*/
                /*arguments passed to %DCA() */
                xstart=0.01, xstop=0.99, xby=0.01, harm=);

  %DO x = 1 %TO &amp;repeats.;
    *Load original data and create a variable to be used to &#39;randomize&#39; patients;
    DATA CROSSVAL_dca_of;
      SET &amp;data.;
      u = RAND(&quot;Uniform&quot;);
    RUN;

    *Sort by the event to ensure equal number of patients with the event are in each group;
    PROC SORT DATA = CROSSVAL_dca_of;
      BY &amp;outcome. u;
    RUN;

    *Assign each patient into one of ten groups;
    DATA CROSSVAL_dca_of;
      SET CROSSVAL_dca_of;
      group = MOD(_n_, &amp;v.) + 1;
    RUN;

    *Loop through to run through for each of the ten groups;
    %DO y = 1 %TO &amp;v.;
      * First, fit the model excluding the yth group.;
      PROC LOGISTIC DATA = CROSSVAL_dca_of OUTMODEL = CROSSVAL_df_model&amp;y. DESCENDING NOPRINT;
        MODEL &amp;outcome. = &amp;predictors.;
        WHERE group ne &amp;y.;
      RUN;

      *Put yth group into base test dataset;
      DATA CROSSVAL_df_test&amp;y.;
        SET CROSSVAL_dca_of;
        WHERE group = &amp;y.;
      RUN;

       *Apply the model to the yth group and save the predicted probabilities of the yth group (that was not used in creating the model);
      PROC LOGISTIC INMODEL=CROSSVAL_df_model&amp;y. NOPRINT;
        SCORE DATA = CROSSVAL_df_test&amp;y. OUT = CROSSVAL_model_pr&amp;y.;
      RUN;
    %END;

    * Combine model predictions for all 10 groups;
    DATA CROSSVAL_model_pr(RENAME = (P_1=model_pred));
      SET CROSSVAL_model_pr1-CROSSVAL_model_pr&amp;v.;
    RUN;

    * Run decision curve and save out results;
    * For those excluding the optional multiple cross validation, this decision curve (to be seen by using &quot;graph=yes&quot;) and the results (saved under the name of your choosing) would be the decision curve corrected for overfit;
    %DCA(data=CROSSVAL_model_pr, out=CROSSVAL_dca&amp;x., outcome=&amp;outcome., predictors=model_pred,
         graph=no, xstart=&amp;xstart., xstop=&amp;xstop., xby=&amp;xby., harm=&amp;harm.);

  *This &quot;%END&quot; statement ends the initial loop for the multiple cross validation. It is also necessary for those who avoided the multiple cross validation by changing the value in the DO loop from 200 to 1;
  %END;

  DATA CROSSVAL_allcv_pr;
    SET CROSSVAL_dca1-CROSSVAL_dca&amp;repeats.;
  RUN;

  * Calculate the average net benefit across all iterations of the multiple cross validation;
  PROC MEANS DATA=CROSSVAL_allcv_pr NOPRINT;
    CLASS threshold;
    VAR all none model_pred;
    OUTPUT OUT=CROSSVAL_minfinal MEAN=all none model_pred;
  RUN;

  * Save out average net benefit and label variables so that the plot legend will have the proper labels.;
  DATA &amp;out. (KEEP=model_pred all none threshold);
    SET CROSSVAL_minfinal;
    LABEL all=&quot;Treat All&quot;;
    LABEL none=&quot;Treat None&quot;;
    LABEL model_pred=&quot;Cross-validated Prediction Model&quot;;
  RUN;

  PROC DATASETS LIB=WORK;
    DELETE CROSSVAL_:;
  RUN;
  QUIT;
%MEND CROSSVAL;

* Run the crossvalidation macro;
%CROSSVAL(data = data_cancer,
          out = allcv_pr,
          outcome = cancer,
          predictors= age famhistory marker,
          xstop = 0.5);

* Plotting the figure of all the net benefits;
PROC GPLOT DATA=allcv_pr;
  axis1 ORDER=(-0.05 to 0.15 by 0.05) LABEL=(ANGLE=90 &quot;Net Benefit&quot;) MINOR=none;
  axis2 ORDER=(0 to 0.5 by 0.1) LABEL=(&quot;Threshold Probability&quot;) MINOR=none;
  legend LABEL=NONE ACROSS=1 CBORDER=BLACK;
  PLOT all*threshold
  none*threshold
  model_pred*threshold /
  VAXIS=axis1
  HAXIS=axis2
  LEGEND=legend OVERLAY;
  SYMBOL INTERPOL=JOIN;
RUN;
QUIT;</code></pre>
</div>
<div id="python-20" class="section level5">
<h5>Python</h5>
<pre class="python"><code># Coming Soon!</code></pre>
</div>
</div>
<div id="section-41" class="section level4 unnumbered">
<h4 class="unnumbered"></h4>
<!-- This chunk runs the R code without printing the code (since that is in the tabset). -->
<p><img src="dca-tutorial_files/figure-html/r-cross_validation-1.png" width="672" /></p>
<hr style="height:1px;border:none;color:#333;background-color:#333;" />
<p>Note: Predicted probabilities for each subject can be used to
calculate other performance metrics, such as discrimination.</p>
<hr style="border: none; border-top: 1px solid #333; color: #333; margin: 20px 0;">
</div>
</div>
<div id="one-more-thing" class="section level2">
<h2>One More Thing</h2>
<p>Before running a decision curve analysis, please do read
<a href="https://www.fharrell.com/post/edca/">Seven Common Errors in
Decision Curve Analysis</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
